<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Regression Code ‚Äì Line by Line | Data Science Course</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 50%, #f0fdf4 100%); min-height: 100vh; padding: 20px; color: #1e293b; line-height: 1.8; }
        .container { max-width: 900px; margin: 0 auto; }
        .nav { background: rgba(255,255,255,0.95); padding: 15px 25px; border-radius: 15px; margin-bottom: 25px; display: flex; gap: 15px; flex-wrap: wrap; border: 1px solid #e2e8f0; }
        .nav a { color: #0ea5e9; text-decoration: none; font-weight: 600; }
        .nav a:hover { color: #0284c7; }
        .header { text-align: center; padding: 35px 25px; background: linear-gradient(135deg, #0ea5e9 0%, #22c55e 100%); border-radius: 20px; margin-bottom: 30px; color: white; }
        .header h1 { font-size: 1.8em; margin-bottom: 10px; }
        .header p { font-size: 1.05em; opacity: 0.95; }
        .section { background: white; border-radius: 16px; padding: 28px; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); border-left: 5px solid #0ea5e9; }
        .section h2 { color: #0ea5e9; font-size: 1.35em; margin-bottom: 14px; }
        .section p { color: #334155; margin-bottom: 12px; font-size: 1.02em; }
        .download-box { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border-radius: 12px; padding: 18px 22px; margin: 16px 0; border-left: 4px solid #22c55e; }
        .download-box a { color: #166534; font-weight: 700; text-decoration: none; }
        .download-box a:hover { text-decoration: underline; }
        .code-block { background: #1e293b; border-radius: 12px; padding: 20px; margin: 16px 0; overflow-x: auto; }
        .code-block pre { margin: 0; font-family: 'Fira Code', monospace; font-size: 0.9em; color: #e2e8f0; line-height: 1.55; }
        .code-block .comment { color: #94a3b8; }
        .code-block .keyword { color: #c084fc; }
        .code-block .function { color: #38bdf8; }
        .code-block .string { color: #4ade80; }
        .code-block .number { color: #fb923c; }
        .line-explain { background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-radius: 12px; padding: 18px 22px; margin: 12px 0; border-left: 4px solid #10b981; }
        .line-explain h4 { color: #065f46; font-size: 1.05em; margin-bottom: 10px; }
        .line-explain ul { margin: 0; padding-left: 22px; color: #064e3b; }
        .line-explain li { margin-bottom: 6px; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="../index.html"><i class="fas fa-home"></i> Home</a>
            <a href="index.html"><i class="fas fa-th-large"></i> Course Hub</a>
            <a href="linear-regression.html"><i class="fas fa-arrow-left"></i> Linear Regression</a>
        </nav>
        <div class="header">
            <h1>Linear Regression Code ‚Äì Line by Line</h1>
            <p>Every line of the linear regression code explained in simple words. We predict house price from area, bedrooms, etc.</p>
        </div>

        <div class="download-box">
            <strong>Download the dataset first:</strong> <a href="datasets/housing_dataset.csv" download="Housing.csv"><i class="fas fa-download"></i> Housing.csv</a> ‚Äî Save it in the same folder as your script so <code>pd.read_csv("Housing.csv")</code> works.
        </div>

        <!-- Step 1: Imports -->
        <div class="section">
            <h2>Step 1: Imports</h2>
            <p>Load the libraries we need.</p>
            <div class="code-block">
<pre><span class="keyword">import</span> warnings
warnings.filterwarnings(<span class="string">'ignore'</span>)
<span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt
<span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</pre>
            </div>
            <div class="line-explain">
                <h4>What each line does</h4>
                <ul>
                    <li><strong>warnings.filterwarnings('ignore')</strong> ‚Äî Hides warning messages so output is easier to read.</li>
                    <li><strong>import numpy as np</strong> ‚Äî For numbers and arrays.</li>
                    <li><strong>import pandas as pd</strong> ‚Äî For DataFrames and reading CSV.</li>
                    <li><strong>import matplotlib.pyplot as plt</strong> ‚Äî For plots.</li>
                    <li><strong>import seaborn as sns</strong> ‚Äî For nicer plots (optional).</li>
                </ul>
            </div>
        </div>

        <!-- Step 2: Load data -->
        <div class="section">
            <h2>Step 2: Load the data</h2>
            <p>Read the Housing CSV into a DataFrame.</p>
            <div class="code-block">
<pre>data = pd.<span class="function">read_csv</span>(<span class="string">"Housing.csv"</span>)
data.<span class="function">head</span>(<span class="number">10</span>)</pre>
            </div>
            <div class="line-explain">
                <h4>What each line does</h4>
                <ul>
                    <li><strong>data = pd.read_csv("Housing.csv")</strong> ‚Äî Reads the file and stores it in <code>data</code>. Columns: price, area, bedrooms, bathrooms, stories, mainroad, guestroom, basement, etc.</li>
                    <li><strong>data.head(10)</strong> ‚Äî Shows the first 10 rows so you can see sample values.</li>
                </ul>
            </div>
        </div>

        <!-- Step 3: Explore -->
        <div class="section">
            <h2>Step 3: Quick look at the data</h2>
            <p>Check column types and counts.</p>
            <div class="code-block">
<pre>data.<span class="function">info</span>()</pre>
            </div>
            <div class="line-explain">
                <h4>What this line does</h4>
                <ul>
                    <li><strong>data.info()</strong> ‚Äî Prints how many rows, column names, data types (int, float, object), and how many non-null values. Helps you spot missing values.</li>
                </ul>
            </div>
        </div>

        <!-- Step 3b: describe() -->
        <div class="section">
            <h2>Step 3b: Summary numbers (describe)</h2>
            <p>See the min, max, average, and spread of every numeric column in one table.</p>
            <div class="code-block">
<pre>data.<span class="function">describe</span>()</pre>
            </div>
            <div class="line-explain">
                <h4>üë∂ In simple terms</h4>
                <ul>
                    <li><strong>data.describe()</strong> ‚Äî Shows a small ‚Äúreport card‚Äù for each number column: count, mean, standard deviation (spread), min, 25%, 50%, 75%, max. Like asking: ‚ÄúWhat‚Äôs the smallest price? The biggest? The average?‚Äù for every numeric column at once.</li>
                    <li>Use it to spot weird values (e.g. area = 0 or price in millions when others are in thousands) before building the model.</li>
                </ul>
            </div>
        </div>

        <!-- Step 4: Train/test split -->
        <div class="section">
            <h2>Step 4: Split into train and test</h2>
            <p>We use 80% of the data to train the model and 20% to test it.</p>
            <div class="code-block">
<pre><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split
df_train, df_test = <span class="function">train_test_split</span>(data, train_size=<span class="number">0.8</span>, test_size=<span class="number">0.2</span>, random_state=<span class="number">100</span>)</pre>
            </div>
            <div class="line-explain">
                <h4>What each line does</h4>
                <ul>
                    <li><strong>train_test_split(data, train_size=0.8, test_size=0.2, random_state=100)</strong> ‚Äî Splits the data: 80% goes to <code>df_train</code>, 20% to <code>df_test</code>. <code>random_state=100</code> makes the split the same every time you run.</li>
                </ul>
            </div>
        </div>

        <!-- Step 5: Prepare X and y -->
        <div class="section">
            <h2>Step 5: Prepare features (X) and target (y)</h2>
            <p>We want to predict <strong>price</strong>. So price is y; the other columns (area, bedrooms, etc.) are X.</p>
            <div class="code-block">
<pre>y_train = df_train[<span class="string">'price'</span>]
X_train = df_train.<span class="function">drop</span>(<span class="string">'price'</span>, axis=<span class="number">1</span>)
y_test = df_test[<span class="string">'price'</span>]
X_test = df_test.<span class="function">drop</span>(<span class="string">'price'</span>, axis=<span class="number">1</span>)</pre>
            </div>
            <div class="line-explain">
                <h4>What each line does</h4>
                <ul>
                    <li><strong>y_train = df_train['price']</strong> ‚Äî The target we want to predict on the training set.</li>
                    <li><strong>X_train = df_train.drop('price', axis=1)</strong> ‚Äî All columns except price; these are the features for training.</li>
                    <li><strong>y_test, X_test</strong> ‚Äî Same for the test set (what we use to check how well the model predicts).</li>
                </ul>
            </div>
        </div>

        <!-- Step 6: Fit model -->
        <div class="section">
            <h2>Step 6: Build and train the model</h2>
            <p>We use sklearn's LinearRegression to fit a line (or plane) to the data.</p>
            <div class="code-block">
<pre><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression
lr_model = <span class="function">LinearRegression</span>()
lr_model.<span class="function">fit</span>(X_train, y_train)</pre>
            </div>
            <div class="line-explain">
                <h4>What each line does</h4>
                <ul>
                    <li><strong>LinearRegression()</strong> ‚Äî Creates an empty linear regression model (no training yet).</li>
                    <li><strong>lr_model.fit(X_train, y_train)</strong> ‚Äî Trains the model: it finds the best weights so that the line (or plane) fits the training data. After this, the model can predict price from the features.</li>
                </ul>
            </div>
        </div>

        <!-- Step 7: Predict and score -->
        <div class="section">
            <h2>Step 7: Predict and check accuracy</h2>
            <p>Use the test set to see how well the model predicts.</p>
            <div class="code-block">
<pre>predictions = lr_model.<span class="function">predict</span>(X_test)
<span class="function">print</span>(<span class="string">f"R¬≤ score on test: {lr_model.score(X_test, y_test):.3f}"</span>)</pre>
            </div>
            <div class="line-explain">
                <h4>What each line does</h4>
                <ul>
                    <li><strong>lr_model.predict(X_test)</strong> ‚Äî Uses the trained model to predict price for each row in X_test.</li>
                    <li><strong>lr_model.score(X_test, y_test)</strong> ‚Äî Returns R¬≤: how much of the variation in price is explained by the model. Closer to 1 is better.</li>
                </ul>
            </div>
        </div>

        <div class="section" style="border-left-color: #f59e0b;">
            <h2>üìö Same topic in the full course notebook</h2>
            <p>The course source also walks through: <strong>outlier treatment</strong> (removing extreme price/area so one house doesn‚Äôt drag the line), <strong>converting yes/no to 1/0</strong>, <strong>dummy variables</strong> for furnishing status, <strong>MinMaxScaler</strong> so all features are on a similar scale, and <strong>residual analysis</strong> (plotting errors to check if the model is fair). Those steps are covered in the main <a href="linear-regression.html">Linear Regression</a> lesson; here we kept the minimal code path so you can run and understand every line quickly. See <strong>Linear Regression.pdf</strong> in the course source for slides.</p>
        <div class="section" style="margin-top: 2rem;">
            <h2>Complete code from course notebook: linear_regression.ipynb</h2>
            <p>Every line of code from the course notebook (verbatim).</p>
            <div class="code-block" style="max-height: 600px; overflow: auto;">
                <pre style="white-space: pre; font-size: 0.85em;"># --- Code cell 1 ---
from IPython.core.display import HTML

HTML("""
&lt;style&gt;

h1 { color: blue !important; }
h2 { color: green !important; }
&lt;/style&gt;
""")

# --- Code cell 2 ---
# Supress Warnings

import warnings
warnings.filterwarnings('ignore')

# Import the numpy and pandas package

import numpy as np
import pandas as pd

# Data Visualisation

import matplotlib.pyplot as plt 
import seaborn as sns

# --- Code cell 4 ---
data = pd.read_csv("Housing.csv")
data.head(10)

# --- Code cell 5 ---
data.info()

# --- Code cell 6 ---
data.describe()

# --- Code cell 8 ---

fig, axs = plt.subplots(2,3, figsize = (10,5))
plt1 = sns.boxplot(data['price'], ax = axs[0,0]).set(xlabel= 'price')
plt2 = sns.boxplot(data['area'], ax = axs[0,1]).set(xlabel='area')
plt3 = sns.boxplot(data['bedrooms'], ax = axs[0,2]).set(xlabel='bedrooms')
plt1 = sns.boxplot(data['bathrooms'], ax = axs[1,0]).set(xlabel='bathrooms')
plt2 = sns.boxplot(data['stories'], ax = axs[1,1]).set(xlabel='stories')
plt3 = sns.boxplot(data['parking'], ax = axs[1,2]).set(xlabel='parking')

plt.tight_layout()

# --- Code cell 9 ---
# outlier treatment for price

Q1 = data.price.quantile(0.25) # data['price'].quantile(0.25)
Q3 = data.price.quantile(0.75)
IQR = Q3 - Q1
data = data[(data.price &gt;= Q1 - 1.5*IQR) &amp; (data.price &lt;= Q3 + 1.5*IQR)]
print(Q3,Q1)

# --- Code cell 10 ---
len(data)

# --- Code cell 11 ---
# outlier treatment for area

Q1 = data.area.quantile(0.25)
Q3 = data.area.quantile(0.75)

IQR = Q3 - Q1
data = data[(data.area &gt;= Q1 - 1.5*IQR) &amp; (data.area &lt;= Q3 + 1.5*IQR)]

# --- Code cell 12 ---
len(data)

# --- Code cell 13 ---
data.columns

# --- Code cell 14 ---
#Correlation of output with numerical variables

# plotting correlation heatmap
dataplot = sns.heatmap(data[['price', 'area', 'bedrooms', 'bathrooms', 'stories','parking']].corr(), cmap="YlGnBu", annot=True)
  
# displaying heatmap
plt.show()

# --- Code cell 15 ---
#Visualizing categorical variables

plt.figure(figsize=(20, 12))
plt.subplot(2,3,1)
sns.boxplot(x = 'mainroad', y = 'price', data = data)
plt.subplot(2,3,2)
sns.boxplot(x = 'guestroom', y = 'price', data = data)
plt.subplot(2,3,3)
sns.boxplot(x = 'basement', y = 'price', data = data)
plt.subplot(2,3,4)
sns.boxplot(x = 'hotwaterheating', y = 'price', data = data)
plt.subplot(2,3,5)
sns.boxplot(x = 'airconditioning', y = 'price', data = data)
plt.subplot(2,3,6)
sns.boxplot(x = 'furnishingstatus', y = 'price', data = data)
plt.show()

# --- Code cell 16 ---
plt.figure(figsize = (10, 5))
sns.boxplot(x = 'mainroad', y = 'price', hue = 'airconditioning', data = data)
plt.show()

# --- Code cell 18 ---
# List of variables to map

cat_features =  ['mainroad', 'guestroom', 'basement', 'hotwaterheating', 'airconditioning', 'prefarea']

# Defining the map function
def create_features(x):
    return x.map({'yes': 1, "no": 0})

# Applying the function to the housing list
data[cat_features] = data[cat_features].apply(create_features)

# --- Code cell 19 ---
data.head(10)

# --- Code cell 20 ---
#Create dummy features for categorical variables

data_cat = pd.get_dummies(data['furnishingstatus'],drop_first=True)

# --- Code cell 21 ---
data_cat.head(100)

# --- Code cell 22 ---

data = pd.concat([data, data_cat], axis = 1)
data.drop(['furnishingstatus'], axis = 1, inplace = True)
data.head(10)

# --- Code cell 24 ---
from sklearn.model_selection import train_test_split

#np.random.seed(0) # not must to do
df_train, df_test = train_test_split(data, train_size = 0.8, test_size = 0.2, random_state = 100)

# --- Code cell 25 ---
from sklearn.preprocessing import MinMaxScaler
scaler = MinMaxScaler()

# --- Code cell 26 ---
# Apply scaler() to all the columns except the 'yes-no' and 'dummy' variables
num_vars = ['area', 'bedrooms', 'bathrooms', 'stories', 'parking']

df_train[num_vars] = scaler.fit_transform(df_train[num_vars])

# --- Code cell 27 ---
df_train.describe()

# --- Code cell 28 ---
df_test[num_vars] = scaler.transform(df_test[num_vars])

# --- Code cell 29 ---
df_test.describe()

# --- Code cell 30 ---
y_train = df_train.pop('price') # df_train['price'] #labels in training data
x_train = df_train # features in training data

# --- Code cell 31 ---
y_test = df_test.pop('price') # df_test['price'] #lables in test data
x_test = df_test # features in test data

# --- Code cell 34 ---
from sklearn.linear_model import LinearRegression

lr_model = LinearRegression()
lr_model.fit(x_train, y_train) # training

# --- Code cell 35 ---
help(LinearRegression)

# --- Code cell 36 ---
#Let's see the summary of our linear model
print(lr_model.coef_)

# --- Code cell 37 ---
# this is for our understanding - not needed for LR model
import numpy as np
importance = np.array(lr_model.coef_)
importance = importance / sum(importance)
print(importance )

# --- Code cell 38 ---
for z in range(len(list(x_train.columns))):
    print("The Importance coefficient for {} is {}".format(x_train.columns[z], importance[z]))

# --- Code cell 39 ---
print(lr_model.intercept_)

# --- Code cell 40 ---
x_train.columns

# --- Code cell 43 ---
#residual analysis
#Residual analysis is typically performed on the training data rather than the test data. 
#The purpose of residual analysis is to assess the performance and
#assumptions of your regression model during the training phase.

# --- Code cell 45 ---
y_train_pred = lr_model.predict(x_train)
residuals = (y_train_pred - y_train)

# --- Code cell 46 ---
# Plot the histogram of the error terms
fig = plt.figure()
sns.distplot(residuals, bins = 20)
fig.suptitle('Error Terms', fontsize = 20)                  # Plot heading 
plt.xlabel('Errors', fontsize = 18)                         # X-label

# --- Code cell 47 ---
plt.scatter(y_train,residuals)
plt.show()
# Model is giving negative error in high house price range and postive error in low house price range
# Its estimating a bit higher prices for houses with lower prices and lower pricess for houses with higher prices
# We might need more data or the relatioship between input and ouput is not necessarily linear in all regions

# In the region where model is doing fine ( residual around 0) - we do have lot of data points

# --- Code cell 50 ---
# Making predictions
y_test_pred = lr_model.predict(x_test)

# --- Code cell 51 ---
from sklearn.metrics import r2_score,mean_absolute_error,mean_absolute_percentage_error
r2_score(y_test, y_test_pred)

# --- Code cell 52 ---
mean_absolute_percentage_error(y_test, y_test_pred)

# --- Code cell 53 ---
# Less than ~20% average percentage error is not a bad result on such a small dataset
# Results would improve if we get more data to train the model
# Some additional fetaures like distance from best school, shoppig and entertainment options etc would also help

# --- Code cell 54 ---
# Plotting y_test and y_pred to understand the spread.
fig = plt.figure()
plt.scatter(y_test,y_test_pred)
fig.suptitle('y_test vs y_test_pred', fontsize=20)              # Plot heading 
plt.xlabel('y_test', fontsize=18)                          # X-label
plt.ylabel('y_test_pred', fontsize=16)                          # Y-label
</pre>
            </div>
        </div>

        <div class="nav" style="margin-top: 30px;">
            <a href="linear-regression.html"><i class="fas fa-arrow-left"></i> Back to Linear Regression</a>
            <a href="index.html"><i class="fas fa-home"></i> Course Hub</a>
        </div>
    </div>
    <script src="../js/code-copy.js"></script>
</body>
</html>
